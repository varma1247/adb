<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello World</title>
    <style>
        .btn-file {
            position: relative;
            overflow: hidden;
        }
        
        .btn-file input[type=file] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            font-size: 100px;
            text-align: right;
            filter: alpha(opacity=0);
            opacity: 0;
            outline: none;
            background: white;
            cursor: inherit;
            display: block;
        }
        
        th {
            text-align: center
        }
    </style>

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.messagestore.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.fallbacks.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.language.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.parser.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.emitter.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.emitter.bidi.js"></script>
    <script src="antixss.js" type="text/javascript"></script>
</head>

<body>
    <div class="text-center">
        <h4>RAGHAVARAJU, SAI VARMA</h4>
        <h4>1001669341</h4>
    </div>
    <div>
        <h4 id='count' class='text-center'></h4>
    </div>
    <div style="width: 80%;height: 100px; margin: auto;overflow-y: scroll" class="text-center" id="starttablediv">
        <div class="text-center" id="startinfodiv"></div>
        <table id="startdetails" class="table table-hover table-striped">
            <thead>
                <th style="text-align: center">Place</th>
                <th style="text-align: center">Latitude</th>
                <th style="text-align: center">Longitude</th>
                <th style="text-align: center">Magnitude</th>
                <th style="text-align: center">Time</th>
            </thead>
            <tbody id='starttbody'>

            </tbody>

        </table>
    </div>
    <div class="row text-center" style="padding: 30px" id="csvdiv">
        <div class="input-group" style="display:inline">
            <span class="btn btn-primary btn-file">
            Upload CSV <input type="file" id="csvfile" name="csvfile" accept=".csv">
        </span>
        </div>
    </div>
    <!-- <div class="row text-center" style="padding: 30px" id="allfdiv">
        <div class="input-group" style="display:inline">
            <button class="btn btn-success" id="allfnames">Get all file names</button>
        </div>
    </div>
    <div class="row text-center" style="padding: 30px" id="roomdiv">
        <div class="input-group" style="display:inline">
            <h4 style="margin-bottom: 15px;">Enter the roomno to get the details</h4>
            <input type="text" class="text-center" placeholder="Enter the room no" style="border-radius:10px" id="roomno">
            <button class="btn btn-success" id="roombutton">Search</button>
        </div>
    </div>
    <div class="row text-center" style="padding: 30px" id="salarydiv">
        <div class="input-group" style="display:inline">
            <h4 style="margin-bottom: 15px;">Enter the salary to get pictures</h4>
            <input type="text" class="text-center" placeholder="Enter the salary" style="border-radius:10px" id="salary">
            <button class="btn btn-success" id="salarybutton">Search</button>
        </div>
    </div> -->
    <div class="row">
        <div class="text-center" id="allfiles" class="col-sm-6">

        </div>
        <div class="text-center" id="allsizes" class="col-sm-6">

        </div>
    </div>
    <div class="row text-center" style="padding: 30px" id="magdiv">
        <div class="input-group" style="display:inline">
            <h4 style="margin-bottom: 15px;">Enter magnitude</h4>
            <input type="text" class="text-center" placeholder="Magnitude" style="border-radius:10px" id="mag">
            <input type="text" class="text-center" placeholder="Magnitude" style="border-radius:10px" id="mag1">
            <button class="btn btn-success" id="magbutton">Search</button>
        </div>
    </div>
    <div class="row text-center" style="padding: 30px" id="magselectdiv">
        <div class="input-group" style="display:inline">
            <h4 style="margin-bottom: 15px;">Enter magnitude range and range of dates</h4>
            <input name="magminselect" id="magminselect" type="text"><span> To </span>
            <input name="magmaxselect" id="magmaxselect" type="text">
            <input type="date" id="startdate">
            <input type="date" id="enddate">
            <button class="btn btn-success" id="magselectbutton">Search</button>
        </div>
    </div>
    <div class="row text-center" style="padding: 30px" id="latlongdiv">
        <div class="input-group" style="display:inline">
            <h4 style="margin-bottom: 15px;">Enter coordinates</h4>
            <input type="text" class="text-center" placeholder="Latitude" style="border-radius:10px" id="lat">
            <input type="text" class="text-center" placeholder="Longitude" style="border-radius:10px" id="long">
            <input type="text" class="text-center" placeholder="Radius in km" style="border-radius:10px" id="radius">
            <button class="btn btn-success" id="latlongbutton">Search</button>
        </div>
    </div>
    <div class="row text-center" style="padding: 30px" id="boundsdiv">
        <div class="input-group" style="display:inline">
            <h4 style="margin-bottom: 15px;">Enter coordinates of two points</h4>
            <label for="firstlat">Top Left coordinates</label>
            <input type="text" class="text-center" placeholder="Latitude" style="border-radius:10px" id="firstlat">
            <input type="text" class="text-center" placeholder="Longitude" style="border-radius:10px" id="firstlong">
            <label for="secondlat">Bottom Right coordinates</label>
            <input type="text" class="text-center" placeholder="Latitude" style="border-radius:10px" id="secondlat">
            <input type="text" class="text-center" placeholder="Longitude" style="border-radius:10px" id="secondlong">
            <input type="text" class="text-center" placeholder="Grid size in km" style="border-radius:10px" id="grid">
            <button class="btn btn-success" id="boundsbutton">Search</button>
        </div>
        <div class="text-center" id="maxearthquakes">
        </div>
    </div>
    <div class="row text-center" style="padding: 30px" id="etimediv">
        <div class="input-group" style="display:inline">
            <h4 style="margin-bottom: 15px;">Click here to know whether more earthquakes occur at night</h4>
            <button class="btn btn-success" id="etimebutton">Click</button>
        </div>
    </div>
    <div class="text-center" id="daynight">
    </div>
    <div style="width: 80%;height: 400px; margin: auto;overflow-y: scroll" class="text-center" id="tablediv">
        <div class="text-center" id="infodiv"></div>
        <table id="details" class="table table-hover table-striped">
            <thead>
                <th style="text-align: center">Place</th>
                <th style="text-align: center">Latitude</th>
                <th style="text-align: center">Longitude</th>
                <th style="text-align: center">Magnitude</th>
                <th style="text-align: center">Time</th>
            </thead>
            <tbody id='maintbody'>

            </tbody>

        </table>
    </div>
    <!-- <div class="row text-center" style="padding: 30px" id="jeeskdiv">
        <div class="input-group" style="display:inline">
            <h4 style="margin-bottom: 15px;">Change name</h4>
            <input type="text" class="text-center" placeholder="Name" style="border-radius:10px" id="jeesk">
            <button class="btn btn-success" id="jeeskbutton">Search</button>
        </div>
    </div> -->
    <!-- <div id="pointsdiv">
        <input type="text" id="point1">
        <input type="text" id='point2'>
        <input type="text" id="room">
        <button id="pointsbutton"></button>
    </div>  -->
    <script>
        $(document).ready(function() {
            // $("#jeeskdiv").hide();
            $("#details").hide();
            $("#maxearthquakes").hide();
            $("#daynight").hide();
            $.ajax({
                url: "/",
                type: "POST",
                data: {},
                success: function(m) {
                    console.log(m);
                    $('starttbody').html('');
                    $("#starttbody").append("<tr><td>" + m.quake.place + "</td><td>" + m.quake.latitude + "</td><td>" + m.quake.longitude + "</td><td>" + m.quake.mag + "</td><td>" + m.quake.time + "</td></tr>")
                    $('#count').html('');
                    $('#count').append(m.count + " earthquakes in total")

                    // $('tbody').html('');
                    // msg.forEach(m => {
                    //     $("tbody").append("<tr><td>" + m.place + "</td><td>" + m.latitude + "</td><td>" + m.longitude + "</td><td>" + m.mag + "</td><td>" + m.time + "</td></tr>")
                    // });
                    // $("#details").show();
                    // $('#infodiv').html('');
                    // $('#infodiv').append("<h4 class='text-center'>" + msg.length + " earthquakes</h4>")
                }
            })
            $("#csvdiv").on("change", "#csvfile", function(e) {
                // var fileName = e.target.files[0].name;
                // console.log(fileName);
                var file = e.target.files[0];
                var formData = new FormData();
                formData.append("csvfile", file)
                $.ajax({
                    url: '/csv',
                    contentType: false,
                    processData: false,
                    data: formData,
                    type: 'post',
                    success: function(data) {
                        if (data) {
                            $("#error").html('');
                            $("#error").text("File uploaded successfully")
                        }
                    },
                    error: function(data) {
                        if (data.status == 500) {
                            $("#error").html('');
                            $("#error").text("File already exists")

                        };

                    }
                });
            })
            $("#magdiv").on('click', '#magbutton', function() {
                var mag = parseFloat($("#mag").val());
                var mag1 = parseFloat($("#mag1").val());
                $.ajax({
                    url: "/mag",
                    type: "POST",
                    data: {
                        mag: mag,
                        mag1: mag1
                    },
                    success: function(msg) {
                        var allmags = []
                        for (let index = mag; index < mag1; index = index + 0.1) {
                            var c = 0;
                            msg.forEach(function(m) {
                                if (m.mag > index && m.mag < index + 0.1) {
                                    c += 1
                                }
                            })
                            console.log(c);

                            $("body").append("<h4> from " + parseFloat(index) + "  to  " + parseFloat((index + 0.1)) + ": " + c + "</h4>")
                        }

                        // $('tbody').html('');
                        // msg.forEach(m => {
                        //     $("tbody").append("<tr><td>" + m.place + "</td><td>" + m.latitude + "</td><td>" + m.longitude + "</td><td>" + m.mag + "</td><td>" + m.time + "</td></tr>")
                        // });
                        // $("#details").show();
                        // $('#infodiv').html('');
                        // $('#infodiv').append("<h4 class='text-center'>" + msg.length + " earthquakes</h4>")
                    }
                });
            })
            $("#magselectdiv").on('click', '#magselectbutton', function() {
                var minmag = $("#magminselect").val();
                var maxmag = $("#magmaxselect").val();
                var startdate = $("#startdate").val();
                var enddate = $("#enddate").val();
                $.ajax({
                    url: "/selectmag",
                    type: "POST",
                    data: {
                        minmag: minmag,
                        maxmag: maxmag,
                        startdate: startdate,
                        enddate: enddate
                    },
                    success: function(msg) {
                        $('tbody').html('');
                        msg.forEach(m => {
                            $("tbody").append("<tr><td>" + m.place + "</td><td>" + m.latitude + "</td><td>" + m.longitude + "</td><td>" + m.mag + "</td><td>" + m.time + "</td></tr>")
                        });
                        $("#details").show();
                        $('#infodiv').html('');
                        $('#infodiv').append("<h4 class='text-center'>" + msg.length + " earthquakes</h4>")
                    }
                });
            })
            $("#latlongdiv").on('click', '#latlongbutton', function() {
                var lat = $("#lat").val();
                var long = $("#long").val();
                var radius = $("#radius").val();
                $.ajax({
                    url: "/latlong",
                    type: "POST",
                    data: {
                        lat: lat,
                        long: long,
                        radius: radius,
                    },
                    success: function(msg) {
                        $('tbody').html('');
                        msg.forEach(m => {
                            $("tbody").append("<tr><td>" + m.place + "</td><td>" + m.latitude + "</td><td>" + m.longitude + "</td><td>" + m.mag + "</td><td>" + m.time + "</td></tr>")
                        });
                        $("#details").show();
                        $('#infodiv').html('');
                        $('#infodiv').append("<h4 class='text-center'>" + msg.length + " earthquakes</h4>")
                    }
                });
            })
            $("#boundsdiv").on('click', '#boundsbutton', function() {
                var firstlat = $("#firstlat").val();
                var firstlong = $("#firstlong").val();
                var secondlat = $("#secondlat").val();
                var secondlong = $("#secondlong").val();
                var grid = $("#grid").val();
                $.ajax({
                    url: "/bounds",
                    type: "POST",
                    data: {
                        firstlat: firstlat,
                        firstlong: firstlong,
                        secondlat: secondlat,
                        secondlong: secondlong,
                        grid: grid,
                    },
                    success: function(msg) {
                        console.log(msg)
                        $('#maintbody').html('');
                        msg.forEach(m => {
                            $("tbody").append("<tr><td>" + m.place + "</td><td>" + m.latitude + "</td><td>" + m.longitude + "</td><td>" + m.mag + "</td><td>" + m.time + "</td></tr>")
                        });
                        $("#details").show();
                        $('#infodiv').html('');
                        $('#infodiv').append("<h4 class='text-center'>" + msg.length + " earthquakes</h4>")
                    }
                });
            })
            $("#etimediv").on('click', '#etimebutton', function() {
                // console.log("hello");
                $.ajax({
                    url: "/etime",
                    type: "POST",
                    data: {
                        etime: "etime"
                    },
                    success: function(msg) {
                        $('#daynight').html('');
                        $('#daynight').append('<h4 class="text-center">' + msg.daycount + ' earth quakes in the morning and    ' + msg.nightcount + ' earthquakes at night</h4>');
                        $('#daynight').show();

                    }
                });
            })


        });
    </script>
</body>

</html>


<script>
    // //Submit data when enter key is pressed
    // $('#user_name').keydown(function(e) {
    //     var name = $('#user_name').val();
    //     if (e.which == 13 && name.length > 0) { //catch Enter key
    //         //POST request to API to create a new visitor entry in the database
    //         $.ajax({
    //                 method: "POST",
    //                 url: "./api/visitors",
    //                 contentType: "application/json",
    //                 data: JSON.stringify({
    //                     name: name
    //                 })
    //             })
    //             .done(function(data) {
    //                 if (data && data.name) {
    //                     if (data._id)
    //                         $('#response').html($.i18n('added_to_database', AntiXSS.sanitizeInput(data.name)));
    //                     else
    //                         $('#response').html($.i18n('hello', AntiXSS.sanitizeInput(data.name)));
    //                 } else {
    //                     $('#response').html(AntiXSS.sanitizeInput(data));
    //                 }
    //                 $('#nameInput').hide();
    //                 getNames();
    //             });
    //     }
    // });

    // //Retrieve all the visitors from the database
    // function getNames() {
    //     $.get("./api/visitors")
    //         .done(function(data) {
    //             if (data.length > 0) {
    //                 data.forEach(function(element, index) {
    //                     data[index] = AntiXSS.sanitizeInput(element)
    //                 });
    //                 $('#databaseNames').html($.i18n('database_contents') + JSON.stringify(data));
    //             }
    //         });
    // }

    // //Call getNames on page load.
    // getNames();
</script>